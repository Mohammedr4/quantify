{% extends "_base.html" %}
{% load humanize %}

{% block content %}
<div class="min-h-full">
  <nav class="bg-gray-800 border-b border-gray-700">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex h-16 items-center justify-between">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <span class="text-xl font-bold text-white">Quantify</span>
          </div>
          <div class="hidden md:block">
            <div class="ml-10 flex items-baseline space-x-4">
              <a href="#" class="bg-gray-900 text-white rounded-md px-3 py-2 text-sm font-medium">Dashboard</a>
              <a href="#" class="text-gray-300 hover:bg-gray-700 hover:text-white rounded-md px-3 py-2 text-sm font-medium">Portfolios</a>
            </div>
          </div>
        </div>
        <div>
            <a href="{% url 'portfolios:transaction_add' %}" class="rounded-md bg-indigo-500 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-400">
                + Add Transaction
            </a>
        </div>
      </div>
    </div>
  </nav>

  <main class="py-10">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      
      <div class="grid grid-cols-1 gap-5 sm:grid-cols-3">
        <div class="overflow-hidden rounded-lg bg-gray-800 shadow">
          <div class="px-4 py-5 sm:p-6">
            <dt class="truncate text-sm font-medium text-gray-400">Total Invested (Cost Basis)</dt>
            <dd class="mt-1 text-3xl font-semibold tracking-tight text-white">${{ total_net_worth|floatformat:2|intcomma }}</dd>
          </div>
        </div>
        
        <div class="overflow-hidden rounded-lg bg-gray-800 shadow relative">
          <div class="px-4 py-5 sm:p-6">
            <dt class="truncate text-sm font-medium text-gray-400">True Total Return</dt>
            <dd class="mt-1 text-3xl font-semibold tracking-tight text-green-400">-- %</dd>
          </div>
          <div class="bg-gray-700/50 px-4 py-4 sm:px-6">
            <div class="text-sm">
              <a href="{% url 'analysis:tax_console' %}" class="font-medium text-indigo-400 hover:text-indigo-300">
                View Tax Console <span aria-hidden="true">&rarr;</span>
              </a>
            </div>
          </div>
        </div>

        <div class="overflow-hidden rounded-lg bg-gray-800 shadow">
          <div class="px-4 py-5 sm:p-6">
            <dt class="truncate text-sm font-medium text-gray-400">Active Portfolios</dt>
            <dd class="mt-1 text-3xl font-semibold tracking-tight text-white">{{ portfolios.count }}</dd>
          </div>
        </div>
      </div>

      <h3 class="mt-8 text-base font-semibold leading-6 text-white">Recent Transactions</h3>
      <div class="mt-4 flow-root">
        <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
          <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
            <table class="min-w-full divide-y divide-gray-700">
              <thead>
                <tr>
                  <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-white sm:pl-0">Asset</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-white">Type</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-white">Date</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-white">Price</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-white">Qty</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-800">
                {% for t in recent_transactions %}
                <tr>
                  <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-white sm:pl-0">
                    {{ t.stock.ticker }}
                  </td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-300">
                    <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium {% if t.transaction_type == 'BUY' %}bg-green-400/10 text-green-400{% else %}bg-red-400/10 text-red-400{% endif %}">
                        {{ t.get_transaction_type_display }}
                    </span>
                  </td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-300">{{ t.date }}</td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-300">${{ t.price|floatformat:2|intcomma }}</td>
                  <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-300">{{ t.quantity|floatformat:4|intcomma }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>
{% endblock content %}